CCBASE		= gcc -g --std=c99 -m32
NONX		= -z execstack
NX  		= -z noexecstack
NOCAN		= --no-stack-protector
CAN		= --stack-protector

.PHONY: all clean aslr-off aslr-on

all: \
	bomb_nonx_nocan bomb_nx_nocan bomb_nx_can \
  bomb128_nonx_nocan bomb128_nx_nocan bomb128_nx_can \
	server_nonx_nocan server_nx_nocan server_nx_can \
	wheres_the_stack_at

clean:
	rm -f \
	bomb_nonx_nocan bomb_nx_nocan bomb_nx_can \
	server_nonx_nocan server_nx_nocan server_nx_can \
	wheres_the_stack_at \
	*~

aslr-off:
	@echo -n "/proc/sys/kernel/randomize_va_space was: " && \
		cat /proc/sys/kernel/randomize_va_space
	echo 0 > /proc/sys/kernel/randomize_va_space
	@echo -n "/proc/sys/kernel/randomize_va_space is now: " && \
		cat /proc/sys/kernel/randomize_va_space

aslr-on:
	@echo -n "/proc/sys/kernel/randomize_va_space was: " && \
		cat /proc/sys/kernel/randomize_va_space
	echo 2 > /proc/sys/kernel/randomize_va_space
	@echo -n "/proc/sys/kernel/randomize_va_space is now: " && \
		cat /proc/sys/kernel/randomize_va_space

bomb_nonx_nocan : bomb.c
	${CCBASE} ${NONX} ${NOCAN} -o $@ $<

bomb_nx_nocan : bomb.c
	${CCBASE} ${NX} ${NOCAN} -o $@ $<

bomb_nx_can : bomb.c
	${CCBASE} ${NX} ${CAN} -o $@ $<

bomb128_nonx_nocan : bomb128.c
	${CCBASE} ${NONX} ${NOCAN} -o $@ $<

bomb128_nx_nocan : bomb128.c
	${CCBASE} ${NX} ${NOCAN} -o $@ $<

bomb128_nx_can : bomb128.c
	${CCBASE} ${NX} ${CAN} -o $@ $<

server_nonx_nocan : server.c
	${CCBASE} ${NONX} ${NOCAN} -o $@ $<

server_nx_nocan : server.c
	${CCBASE} ${NX} ${NOCAN} -o $@ $<

server_nx_can : server.c
	${CCBASE} ${NX} ${CAN} -o $@ $<

wheres_the_stack_at : wheres_the_stack_at.c
	${CCBASE} ${NX} ${CAN} -o $@ $<
